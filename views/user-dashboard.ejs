<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/user-dashboard.css" />
    <link rel="shortcut icon" href="images/logo.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <div class="custom-header">
      <div class="logo">
        <img src="/images/logo.png" alt="Logo" />
      </div>
      <div class="welcome-text">
        <h1>Welcome Back, <%= user.username %>!</h1>
      </div>
      <div class="profile-icon">
        <i class="fa-solid fa-circle-user"></i>
      </div>
    </div>

    <!-- Side Navbar -->
    <div class="navbar">
      <nav>
        <ul>
          <li><a href="/user-dashboard">DASHBOARD</a></li>
          <li><a href="/user-workout">WORKOUT</a></li>
          <li><a href="/user-nutrition">NUTRITION</a></li>
          <li><a href="/user-profile">PROFILE</a></li>
        </ul>
      </nav>
    </div>

    <!-- Main Content: Container beside Navbar -->
    <div class="content-container">
      <div class="overview-card">
        <div class="overview-header">
          <h2>Overview</h2>
          <button class="overview-button" onclick="openBMIModal()">
            BMI CALCULATOR
          </button>
        </div>
        <div class="inner-container-wrapper">
          <div class="inner-container">
            <h3>Workout Summary</h3>
          </div>
          <div class="inner-container">
            <h3>Nutrition Summary</h3>
          </div>
        </div>
        <div class="inner-container-below">
          <h3>Progress Tracker</h3>
        </div>
      </div>
    </div>

    <!-- Right Side New Container -->
    <div class="right-side-container">
      <h3>UPCOMING WORKOUT</h3>
      <div id="upcomingWorkoutContainer"></div>
      <!-- Container for displaying all workouts -->
    </div>

    <!-- Workout Table -->
    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>Workout Name</th>
          <th>Description</th>
          <th>Image</th>
          <th>Intensity</th>
          <th>Duration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="workoutTableBody"></tbody>
    </table>

    <!-- BMI Calculator Modal -->
    <div id="bmiModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeBMIModal()">&times;</span>
        <h2>BMI Calculator</h2>
        <form onsubmit="calculateBMI(event)">
          <label for="weight">Weight (kg):</label>
          <input type="number" id="weight" required />
          <label for="height">Height (cm):</label>
          <input type="number" id="height" step="0.01" required />
          <button type="submit">Calculate</button>
        </form>
        <div id="bmiResultContainer">
          <p class="bmi-value" id="bmiValue"></p>
          <p class="bmi-category" id="bmiCategory"></p>
        </div>
      </div>
    </div>

    <!-- Review Prompt Modal -->
    <div id="reviewModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeReviewModal()">&times;</span>
        <h2>Would you like to leave a review?</h2>
        <p>Your feedback helps us improve!</p>
        <form id="reviewForm" onsubmit="submitReview(event)">
          <textarea
            id="reviewText"
            placeholder="Enter your review here..."
            required
          ></textarea>
          <div class="button-container">
            <button type="submit">Submit Review</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // BMI Modal Functions
      function openBMIModal() {
        document.getElementById("bmiModal").style.display = "block";
      }

      function closeBMIModal() {
        document.getElementById("bmiModal").style.display = "none";
        document.getElementById("bmiValue").innerText = "";
        document.getElementById("bmiCategory").innerText = "";
      }

      function calculateBMI(event) {
        event.preventDefault();
        const weight = parseFloat(document.getElementById("weight").value);
        const height =
          parseFloat(document.getElementById("height").value) / 100;

        if (weight > 0 && height > 0) {
          const bmi = (weight / (height * height)).toFixed(1);
          let category = "";

          if (bmi < 18.5) {
            category = "Underweight";
          } else if (bmi >= 18.5 && bmi <= 24.9) {
            category = "Normal weight";
          } else if (bmi >= 25 && bmi <= 29.9) {
            category = "Overweight";
          } else {
            category = "Obesity";
          }

          document.getElementById("bmiValue").innerText = `Your BMI is ${bmi}`;
          document.getElementById(
            "bmiCategory"
          ).innerText = `Category: ${category}`;
        }
      }

      // Review Modal Functions
      function openReviewModal() {
        document.getElementById("reviewModal").style.display = "block";
      }

      function closeReviewModal() {
        document.getElementById("reviewModal").style.display = "none";
      }

      function submitReview(event) {
        event.preventDefault(); // Prevent the default form submission

        const reviewText = document.getElementById("reviewText").value; // Get review text
        const rating = 5; // Assume a fixed rating, modify as needed

        // Basic validation
        if (!reviewText.trim()) {
          alert("Please enter your review.");
          return; // Prevent submission
        }

        // Prepare the data to send
        const reviewData = {
          rating: rating, // Fixed rating for simplicity
          comment: reviewText, // The review text
        };

        // Send the review data to the server
        fetch("/reviews", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(reviewData),
        })
          .then((response) => {
            console.log("Response received:", response); // Log the response
            if (!response.ok) {
              throw new Error(
                "Network response was not ok: " + response.statusText
              );
            }
            return response.json();
          })
          .then((data) => {
            console.log("Review submitted successfully:", data);
            closeReviewModal(); // Close the modal after submission
            alert("Thank you for your feedback!"); // Notify user of success
          })
          .catch((error) => {
            console.error("Error submitting review:", error);
            alert(
              "There was an error submitting your review. Please try again."
            ); // Alert user
          });
      }

      // Show the review modal after 10 seconds (10,000 milliseconds)
      setTimeout(openReviewModal, 1000);
    </script>
  </body>
</html>
