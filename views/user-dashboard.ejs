<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/user-dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <div class="custom-header">
        <div class="logo">
            <img src="/images/logo.png" alt="Logo">
        </div>
        <div class="welcome-text">
            <h1>Welcome Back, <span id="user-fullname">Guest</span>!</h1>
        </div>
        <div class="profile-icon" onclick="location.href='/user-profile'">
            <i class="fa-solid fa-circle-user"></i>
        </div>
    </div>

    <!-- Side Navbar -->
    <div class="navbar">
        <nav>
            <ul>
                <li><a href="/user-dashboard" class="active">DASHBOARD</a></li>
                <li><a href="/user-workout">WORKOUT</a></li>
                <li><a href="/user-nutrition">NUTRITION</a></li>
                <li><a href="/user-profile">PROFILE</a></li>
            </ul>
        </nav>
    </div>

    <!-- Main Content: Container beside Navbar -->
    <div class="content-container">
        <div class="overview-card">
            <h2>Overview</h2>
            <div class="inner-container-wrapper">
                <div class="inner-container">
                    <h3>Workout Summary</h3>
                </div>
                <div class="inner-container">
                    <h3>Nutrition Summary</h3>
                </div>
            </div>
            <div class="inner-container-below">
                <h3>Progress Tracker</h3>
            </div>
        </div>  
    </div>

    <!-- Right Side New Container -->
    <div class="right-side-container">
        <h3>UPCOMING WORKOUT</h3>
        <p id="workout-list"></p>
        <div class="lower-right-container">
            <h3>Goal</h3>
            <p>Goal: <span></span></p>
            <p>Calorie Burned: <span></span></p>
            <p>Protein: <span></span></p>
            <p>Carbs: <span></span></p>
            <p>Fats: <span></span></p>
        </div>
    </div>

    <script>
        async function fetchUsername() {
            try {
                const response = await fetch('/user-info');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                document.getElementById('user-fullname').textContent = data.username;
            } catch (error) {
                console.error('Error fetching username:', error);
                document.getElementById('user-fullname').textContent = data.username; // Default
            }
        }

        async function fetchUserWorkouts() {
            try {
                const response = await fetch('/user-workouts');
                if (!response.ok) throw new Error('Network response was not ok');
                const workouts = await response.json();
                displayWorkouts(workouts);
            } catch (error) {
                console.error('Error fetching workouts:', error);
            }
        }

        function displayWorkouts(workouts) {
            const workoutList = document.getElementById('workout-list');
            workoutList.innerHTML = '';
            workouts.forEach(workout => {
                const workoutItem = document.createElement('div');
                workoutItem.className = 'workout-item';
                workoutItem.innerHTML = `
                    <img src="${workout.image}" alt="${workout.name}" class="workout-image" style="width: 50px;">
                    <h4>${workout.name}</h4>
                    <p>Date: ${workout.date}</p>
                    <p>Duration: ${workout.duration} minutes</p>
                    <button onclick="handleDelete(${workout.id})">Delete</button>
                `;
                workoutList.appendChild(workoutItem);
            });
        }

        async function handleDelete(id) {
            if (confirm('Are you sure you want to delete this workout?')) {
                try {
                    const response = await fetch(`/user-workouts/${id}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('Failed to delete workout');
                    alert('Workout deleted successfully');
                    fetchUserWorkouts(); // Refresh the workout list
                } catch (error) {
                    console.error('Error deleting workout:', error);
                }
            }
        }

        window.onload = () => {
            fetchUsername();
            fetchUserWorkouts();
        };
    </script>
</body>
</html>
